import React, {useState} from "react";
import {
    PolygonLayer,
    MapboxScene,
    LoadImage,
    PointLayer
} from "@antv/l7-react";
import { InputRange } from '@holism/core';
import gpb from "../../../assets/img/bank icons/gpb.svg";
import alpha from "../../../assets/img/bank icons/alpha.svg";
import vtb from "../../../assets/img/bank icons/vtb.svg";

let json_data = require('../../../constants/flow_map.json');

const atmData = [
    {
        id: 0,
        latitude: 43.112017,
        longitude: 131.936956,
        name: "\u0413\u0430\u0437\u043f\u0440\u043e\u043c\u0431\u0430\u043d\u043a",
    },
    {
        id: 1,
        latitude: 43.11597,
        longitude: 131.886069,
        name: "\u0413\u0430\u0437\u043f\u0440\u043e\u043c\u0431\u0430\u043d\u043a",
    },
    {
        id: 2,
        latitude: 43.116595,
        longitude: 131.888456,
        name: "\u0413\u0430\u0437\u043f\u0440\u043e\u043c\u0431\u0430\u043d\u043a",
    },
    {
        id: 3,
        latitude: 43.100363,
        longitude: 131.903895,
        name: "\u0413\u0430\u0437\u043f\u0440\u043e\u043c\u0431\u0430\u043d\u043a",
    },
    {
        id: 4,
        latitude: 43.093367,
        longitude: 131.904474,
        name: "\u0413\u0430\u0437\u043f\u0440\u043e\u043c\u0431\u0430\u043d\u043a",
    },
    {
        id: 5,
        latitude: 43.089615,
        longitude: 131.86105,
        name: "\u0413\u0430\u0437\u043f\u0440\u043e\u043c\u0431\u0430\u043d\u043a",
    },
    {
        id: 6,
        latitude: 43.116595,
        longitude: 131.882742,
        name: "\u0413\u0430\u0437\u043f\u0440\u043e\u043c\u0431\u0430\u043d\u043a",
    },
    {
        id: 7,
        latitude: 43.08795,
        longitude: 131.923319,
        name: "\u0413\u0430\u0437\u043f\u0440\u043e\u043c\u0431\u0430\u043d\u043a",
    },
    {
        id: 8,
        latitude: 43.132651,
        longitude: 131.905409,
        name: "\u0413\u0430\u0437\u043f\u0440\u043e\u043c\u0431\u0430\u043d\u043a",
    },
    {
        id: 9,
        latitude: 43.112916,
        longitude: 131.96141,
        name: "\u0413\u0430\u0437\u043f\u0440\u043e\u043c\u0431\u0430\u043d\u043a",
    },
    {
        id: 10,
        latitude: 43.1129,
        longitude: 131.9289,
        name: "\u0413\u0430\u0437\u043f\u0440\u043e\u043c\u0431\u0430\u043d\u043a",
    },
    {
        id: 11,
        latitude: 43.118918,
        longitude: 131.884218,
        name: "\u0413\u0430\u0437\u043f\u0440\u043e\u043c\u0431\u0430\u043d\u043a",
    },
    {
        id: 12,
        latitude: 43.094045,
        longitude: 131.902813,
        name: "\u0413\u0430\u0437\u043f\u0440\u043e\u043c\u0431\u0430\u043d\u043a",
    },
    {
        id: 13,
        latitude: 43.1139,
        longitude: 131.8898,
        name: "\u0413\u0430\u0437\u043f\u0440\u043e\u043c\u0431\u0430\u043d\u043a",
    },
    {
        id: 14,
        latitude: 43.125591,
        longitude: 131.915403,
        name: "\u0413\u0430\u0437\u043f\u0440\u043e\u043c\u0431\u0430\u043d\u043a",
    },
    {
        id: 15,
        latitude: 43.129493,
        longitude: 131.893219,
        name: "\u0413\u0430\u0437\u043f\u0440\u043e\u043c\u0431\u0430\u043d\u043a",
    },
    {
        id: 16,
        latitude: 43.129239,
        longitude: 131.9399,
        name: "\u0413\u0430\u0437\u043f\u0440\u043e\u043c\u0431\u0430\u043d\u043a",
    },
    {
        id: 17,
        latitude: 43.111988,
        longitude: 131.917537,
        name: "\u0413\u0430\u0437\u043f\u0440\u043e\u043c\u0431\u0430\u043d\u043a",
    },
    {
        id: 18,
        latitude: 43.066881,
        longitude: 131.890182,
        name: "\u0413\u0430\u0437\u043f\u0440\u043e\u043c\u0431\u0430\u043d\u043a",
    },
    {
        id: 19,
        latitude: 43.119366,
        longitude: 131.955715,
        name: "\u0413\u0430\u0437\u043f\u0440\u043e\u043c\u0431\u0430\u043d\u043a",
    },
    {
        id: 20,
        latitude: 43.131521,
        longitude: 131.916383,
        name: "\u0413\u0430\u0437\u043f\u0440\u043e\u043c\u0431\u0430\u043d\u043a",
    },
    {
        id: 21,
        latitude: 43.116042,
        longitude: 131.885351,
        name: "\u0413\u0430\u0437\u043f\u0440\u043e\u043c\u0431\u0430\u043d\u043a",
    },
    {
        id: 22,
        latitude: 43.102603,
        longitude: 131.917861,
        name: "\u0413\u0430\u0437\u043f\u0440\u043e\u043c\u0431\u0430\u043d\u043a",
    },
    {
        id: 23,
        latitude: 43.115665,
        longitude: 131.908792,
        name: "\u0413\u0430\u0437\u043f\u0440\u043e\u043c\u0431\u0430\u043d\u043a",
    },
    {
        id: 24,
        latitude: 43.099829,
        longitude: 131.961823,
        name: "\u0413\u0430\u0437\u043f\u0440\u043e\u043c\u0431\u0430\u043d\u043a",
    },
    {
        id: 25,
        latitude: 43.167572,
        longitude: 131.912115,
        name: "\u0413\u0430\u0437\u043f\u0440\u043e\u043c\u0431\u0430\u043d\u043a",
    },
    {
        id: 26,
        latitude: 43.162529,
        longitude: 131.952493,
        name: "\u0413\u0430\u0437\u043f\u0440\u043e\u043c\u0431\u0430\u043d\u043a",
    },
    {
        id: 27,
        latitude: 43.168161,
        longitude: 131.926286,
        name: "\u0413\u0430\u0437\u043f\u0440\u043e\u043c\u0431\u0430\u043d\u043a",
    },
    {
        id: 28,
        latitude: 43.151359,
        longitude: 131.909065,
        name: "\u0413\u0430\u0437\u043f\u0440\u043e\u043c\u0431\u0430\u043d\u043a",
    },
    {
        id: 29,
        latitude: 43.146283,
        longitude: 131.908903,
        name: "\u0413\u0430\u0437\u043f\u0440\u043e\u043c\u0431\u0430\u043d\u043a",
    },
    {
        id: 30,
        latitude: 43.1576,
        longitude: 131.9259,
        name: "\u0413\u0430\u0437\u043f\u0440\u043e\u043c\u0431\u0430\u043d\u043a",
    },
];

const clusterDataFeatures = [{"type": "Feature", "properties": {"square_id": "172579139347", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.869, 43.102973], [131.869, 43.103405], [131.87, 43.103405], [131.871, 43.103405], [131.871, 43.102973], [131.87, 43.102973], [131.869, 43.102973]]]}}, {"type": "Feature", "properties": {"square_id": "172482670595", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.897, 43.02356], [131.897, 43.023992], [131.898, 43.023992], [131.898, 43.02356], [131.897, 43.02356]]]}}, {"type": "Feature", "properties": {"square_id": "172579139350", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.87, 43.103405], [131.871, 43.103405], [131.871, 43.102973], [131.87, 43.102973], [131.869, 43.102973], [131.869, 43.103405], [131.87, 43.103405]]]}}, {"type": "Feature", "properties": {"square_id": "172579139438", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.874, 43.105132], [131.874, 43.105564], [131.874, 43.105996], [131.875, 43.105996], [131.875, 43.105564], [131.875, 43.105132], [131.874, 43.105132]]]}}, {"type": "Feature", "properties": {"square_id": "172482670556", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.894, 43.023992], [131.894, 43.024423], [131.895, 43.024423], [131.895, 43.023992], [131.894, 43.023992], [131.893, 43.024423], [131.893, 43.024854], [131.894, 43.024854], [131.894, 43.024423], [131.893, 43.024423]]]}}, {"type": "Feature", "properties": {"square_id": "172579139436", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.874, 43.105132], [131.874, 43.105564], [131.874, 43.105996], [131.875, 43.105996], [131.875, 43.105564], [131.875, 43.105132], [131.874, 43.105132]]]}}, {"type": "Feature", "properties": {"square_id": "172482670555", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.894, 43.023992], [131.894, 43.024423], [131.895, 43.024423], [131.895, 43.023992], [131.894, 43.023992], [131.893, 43.024423], [131.893, 43.024854], [131.894, 43.024854], [131.894, 43.024423], [131.893, 43.024423]]]}}, {"type": "Feature", "properties": {"square_id": "172574945236", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.894, 43.099086], [131.894, 43.099518], [131.895, 43.099518], [131.895, 43.099086], [131.894, 43.099086]]]}}, {"type": "Feature", "properties": {"square_id": "172570750971", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.893, 43.098654], [131.893, 43.099086], [131.894, 43.099086], [131.894, 43.098654], [131.893, 43.098654]]]}}, {"type": "Feature", "properties": {"square_id": "172566557275", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.973, 43.093904], [131.974, 43.093904], [131.974, 43.093472], [131.973, 43.093472], [131.972, 43.093472], [131.972, 43.093904], [131.973, 43.093904]]]}}, {"type": "Feature", "properties": {"square_id": "172566557296", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.972, 43.093904], [131.972, 43.094336], [131.973, 43.094336], [131.973, 43.093904], [131.972, 43.093904]]]}}, {"type": "Feature", "properties": {"square_id": "172570751607", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.975, 43.098222], [131.976, 43.098222], [131.976, 43.097791], [131.975, 43.097791], [131.974, 43.097791], [131.974, 43.098222], [131.975, 43.098222]]]}}, {"type": "Feature", "properties": {"square_id": "172566557274", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.972, 43.093472], [131.972, 43.093904], [131.973, 43.093904], [131.974, 43.093904], [131.974, 43.093472], [131.973, 43.093472], [131.972, 43.093472]]]}}, {"type": "Feature", "properties": {"square_id": "172570751333", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.939, 43.097359], [131.939, 43.097791], [131.94, 43.097791], [131.94, 43.097359], [131.939, 43.097359]]]}}, {"type": "Feature", "properties": {"square_id": "172574945696", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.949, 43.09995], [131.949, 43.100382], [131.949, 43.100813], [131.95, 43.100813], [131.95, 43.100382], [131.95, 43.09995], [131.949, 43.09995], [131.944, 43.100813], [131.944, 43.101245], [131.945, 43.101245], [131.945, 43.100813], [131.944, 43.100813], [131.945, 43.101245], [131.945, 43.101677], [131.946, 43.101677], [131.946, 43.101245], [131.945, 43.101245]]]}}, {"type": "Feature", "properties": {"square_id": "172570751399", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.947, 43.097791], [131.947, 43.098222], [131.948, 43.098222], [131.948, 43.097791], [131.947, 43.097791]]]}}, {"type": "Feature", "properties": {"square_id": "172574945689", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.944, 43.100813], [131.944, 43.101245], [131.945, 43.101245], [131.945, 43.100813], [131.944, 43.100813], [131.949, 43.09995], [131.949, 43.100382], [131.949, 43.100813], [131.95, 43.100813], [131.95, 43.100382], [131.95, 43.09995], [131.949, 43.09995]]]}}, {"type": "Feature", "properties": {"square_id": "172574945265", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.893, 43.100813], [131.893, 43.101245], [131.894, 43.101245], [131.894, 43.100813], [131.893, 43.100813]]]}}, {"type": "Feature", "properties": {"square_id": "172574945691", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.949, 43.09995], [131.949, 43.100382], [131.949, 43.100813], [131.95, 43.100813], [131.95, 43.100382], [131.95, 43.09995], [131.949, 43.09995], [131.944, 43.100813], [131.944, 43.101245], [131.945, 43.101245], [131.945, 43.100813], [131.944, 43.100813], [131.945, 43.101245], [131.945, 43.101677], [131.946, 43.101677], [131.946, 43.101245], [131.945, 43.101245]]]}}, {"type": "Feature", "properties": {"square_id": "172574945652", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.942, 43.100813], [131.942, 43.101245], [131.943, 43.101245], [131.943, 43.100813], [131.942, 43.100813]]]}}, {"type": "Feature", "properties": {"square_id": "172570751606", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.974, 43.097791], [131.974, 43.098222], [131.975, 43.098222], [131.976, 43.098222], [131.976, 43.097791], [131.975, 43.097791], [131.974, 43.097791]]]}}, {"type": "Feature", "properties": {"square_id": "172574945699", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.949, 43.09995], [131.949, 43.100382], [131.949, 43.100813], [131.95, 43.100813], [131.95, 43.100382], [131.95, 43.09995], [131.949, 43.09995], [131.944, 43.100813], [131.944, 43.101245], [131.945, 43.101245], [131.945, 43.100813], [131.944, 43.100813], [131.945, 43.101245], [131.945, 43.101677], [131.946, 43.101677], [131.946, 43.101245], [131.945, 43.101245]]]}}, {"type": "Feature", "properties": {"square_id": "172595916815", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.899, 43.116794], [131.899, 43.117226], [131.898, 43.117226], [131.898, 43.117658], [131.899, 43.117658], [131.899, 43.11809], [131.9, 43.11809], [131.9, 43.117658], [131.9, 43.117226], [131.9, 43.116794], [131.899, 43.116794]]]}}, {"type": "Feature", "properties": {"square_id": "172608499935", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.927, 43.128026], [131.927, 43.128458], [131.928, 43.128458], [131.928, 43.128026], [131.927, 43.128026]]]}}, {"type": "Feature", "properties": {"square_id": "172604306350", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[132.01, 43.126298], [132.01, 43.12673], [132.011, 43.12673], [132.011, 43.126298], [132.01, 43.126298]]]}}, {"type": "Feature", "properties": {"square_id": "172579140066", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.952, 43.1047], [131.952, 43.105132], [131.953, 43.105132], [131.953, 43.1047], [131.952, 43.1047]]]}}, {"type": "Feature", "properties": {"square_id": "172612695102", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[132.03, 43.133211], [132.03, 43.133643], [132.031, 43.133643], [132.031, 43.133211], [132.03, 43.133211]]]}}, {"type": "Feature", "properties": {"square_id": "172595916812", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.899, 43.116794], [131.899, 43.117226], [131.898, 43.117226], [131.898, 43.117658], [131.899, 43.117658], [131.899, 43.11809], [131.9, 43.11809], [131.9, 43.117658], [131.9, 43.117226], [131.9, 43.116794], [131.899, 43.116794]]]}}, {"type": "Feature", "properties": {"square_id": "172591722884", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.946, 43.112906], [131.946, 43.113338], [131.947, 43.113338], [131.947, 43.112906], [131.946, 43.112906]]]}}, {"type": "Feature", "properties": {"square_id": "172587528957", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.991, 43.112043], [131.991, 43.112475], [131.992, 43.112475], [131.992, 43.112043], [131.991, 43.112043]]]}}, {"type": "Feature", "properties": {"square_id": "172595916807", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.899, 43.116794], [131.899, 43.117226], [131.898, 43.117226], [131.898, 43.117658], [131.899, 43.117658], [131.899, 43.11809], [131.9, 43.11809], [131.9, 43.117658], [131.9, 43.117226], [131.9, 43.116794], [131.899, 43.116794]]]}}, {"type": "Feature", "properties": {"square_id": "172608500008", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.928, 43.129322], [131.928, 43.129754], [131.929, 43.129754], [131.929, 43.129322], [131.928, 43.129322]]]}}, {"type": "Feature", "properties": {"square_id": "172608499970", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.928, 43.127162], [131.928, 43.127594], [131.929, 43.127594], [131.929, 43.127162], [131.928, 43.127162], [131.926, 43.129322], [131.926, 43.129754], [131.927, 43.129754], [131.928, 43.129754], [131.928, 43.129322], [131.927, 43.129322], [131.926, 43.129322]]]}}, {"type": "Feature", "properties": {"square_id": "172600112061", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[132.015, 43.12241], [132.015, 43.122842], [132.016, 43.122842], [132.016, 43.12241], [132.015, 43.12241]]]}}, {"type": "Feature", "properties": {"square_id": "172587528589", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.947, 43.110315], [131.947, 43.110747], [131.948, 43.110747], [131.948, 43.110315], [131.947, 43.110315]]]}}, {"type": "Feature", "properties": {"square_id": "172595917185", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.945, 43.116362], [131.945, 43.116794], [131.946, 43.116794], [131.946, 43.116362], [131.945, 43.116362]]]}}, {"type": "Feature", "properties": {"square_id": "172595916839", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.899, 43.118522], [131.899, 43.118954], [131.9, 43.118954], [131.9, 43.118522], [131.899, 43.118522]]]}}, {"type": "Feature", "properties": {"square_id": "172604306328", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[132.012, 43.124138], [132.012, 43.12457], [132.013, 43.12457], [132.013, 43.124138], [132.012, 43.124138]]]}}, {"type": "Feature", "properties": {"square_id": "172612695135", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[132.039, 43.131482], [132.039, 43.131915], [132.04, 43.131915], [132.04, 43.131482], [132.039, 43.131482]]]}}, {"type": "Feature", "properties": {"square_id": "172608499957", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.927, 43.12889], [131.928, 43.12889], [131.928, 43.128458], [131.927, 43.128458], [131.926, 43.128458], [131.926, 43.12889], [131.926, 43.129322], [131.926, 43.129754], [131.927, 43.129754], [131.928, 43.129754], [131.928, 43.129322], [131.927, 43.129322], [131.927, 43.12889]]]}}, {"type": "Feature", "properties": {"square_id": "172595916813", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.899, 43.116794], [131.899, 43.117226], [131.898, 43.117226], [131.898, 43.117658], [131.899, 43.117658], [131.899, 43.11809], [131.9, 43.11809], [131.9, 43.117658], [131.9, 43.117226], [131.9, 43.116794], [131.899, 43.116794]]]}}, {"type": "Feature", "properties": {"square_id": "172583334624", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.984, 43.107723], [131.984, 43.108155], [131.984, 43.108587], [131.985, 43.108587], [131.985, 43.108155], [131.985, 43.107723], [131.984, 43.107723]]]}}, {"type": "Feature", "properties": {"square_id": "172621083268", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.978, 43.1371], [131.978, 43.137532], [131.979, 43.137532], [131.979, 43.1371], [131.978, 43.1371]]]}}, {"type": "Feature", "properties": {"square_id": "172616888575", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.926, 43.136235], [131.926, 43.136667], [131.926, 43.1371], [131.927, 43.1371], [131.928, 43.1371], [131.928, 43.136667], [131.927, 43.136667], [131.927, 43.136235], [131.926, 43.136235]]]}}, {"type": "Feature", "properties": {"square_id": "172616888894", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.966, 43.136667], [131.966, 43.1371], [131.967, 43.1371], [131.967, 43.136667], [131.966, 43.136667]]]}}, {"type": "Feature", "properties": {"square_id": "172621083093", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.959, 43.1371], [131.959, 43.137532], [131.96, 43.137532], [131.96, 43.1371], [131.959, 43.1371]]]}}, {"type": "Feature", "properties": {"square_id": "172608499958", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.926, 43.128458], [131.926, 43.12889], [131.926, 43.129322], [131.926, 43.129754], [131.927, 43.129754], [131.928, 43.129754], [131.928, 43.129322], [131.927, 43.129322], [131.927, 43.12889], [131.928, 43.12889], [131.928, 43.128458], [131.927, 43.128458], [131.926, 43.128458]]]}}, {"type": "Feature", "properties": {"square_id": "172625277138", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.922, 43.141421], [131.922, 43.141853], [131.923, 43.141853], [131.923, 43.141421], [131.922, 43.141421], [131.924, 43.140989], [131.924, 43.141421], [131.925, 43.141421], [131.925, 43.140989], [131.924, 43.140989]]]}}, {"type": "Feature", "properties": {"square_id": "172612694265", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.929, 43.130186], [131.929, 43.130618], [131.93, 43.130618], [131.93, 43.130186], [131.929, 43.130186], [131.927, 43.131915], [131.927, 43.132347], [131.928, 43.132347], [131.928, 43.131915], [131.927, 43.131915], [131.925, 43.132779], [131.925, 43.133211], [131.926, 43.133211], [131.926, 43.132779], [131.925, 43.132779], [131.927, 43.133211], [131.927, 43.133643], [131.928, 43.133643], [131.928, 43.133211], [131.927, 43.133211]]]}}, {"type": "Feature", "properties": {"square_id": "172633665692", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.918, 43.148335], [131.918, 43.148767], [131.918, 43.1492], [131.919, 43.1492], [131.919, 43.148767], [131.919, 43.148335], [131.918, 43.148335]]]}}, {"type": "Feature", "properties": {"square_id": "172616888952", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.972, 43.136235], [131.972, 43.136667], [131.973, 43.136667], [131.973, 43.136235], [131.972, 43.136235]]]}}, {"type": "Feature", "properties": {"square_id": "172616888831", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.959, 43.136667], [131.959, 43.1371], [131.96, 43.1371], [131.96, 43.136667], [131.959, 43.136667]]]}}, {"type": "Feature", "properties": {"square_id": "172612694271", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.929, 43.130186], [131.929, 43.130618], [131.93, 43.130618], [131.93, 43.130186], [131.929, 43.130186], [131.927, 43.131915], [131.927, 43.132347], [131.928, 43.132347], [131.928, 43.131915], [131.927, 43.131915], [131.925, 43.132779], [131.925, 43.133211], [131.926, 43.133211], [131.926, 43.132779], [131.925, 43.132779], [131.927, 43.133211], [131.927, 43.133643], [131.928, 43.133643], [131.928, 43.133211], [131.927, 43.133211]]]}}, {"type": "Feature", "properties": {"square_id": "172612694318", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.93, 43.133211], [131.93, 43.133643], [131.931, 43.133643], [131.931, 43.133211], [131.93, 43.133211]]]}}, {"type": "Feature", "properties": {"square_id": "172625277132", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.924, 43.140989], [131.924, 43.141421], [131.925, 43.141421], [131.925, 43.140989], [131.924, 43.140989], [131.922, 43.141421], [131.922, 43.141853], [131.923, 43.141853], [131.923, 43.141421], [131.922, 43.141421]]]}}, {"type": "Feature", "properties": {"square_id": "172633666115", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.969, 43.147903], [131.969, 43.148335], [131.97, 43.148335], [131.97, 43.147903], [131.969, 43.147903]]]}}, {"type": "Feature", "properties": {"square_id": "172608499964", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.928, 43.127162], [131.928, 43.127594], [131.929, 43.127594], [131.929, 43.127162], [131.928, 43.127162], [131.926, 43.128458], [131.926, 43.12889], [131.926, 43.129322], [131.926, 43.129754], [131.927, 43.129754], [131.928, 43.129754], [131.928, 43.129322], [131.927, 43.129322], [131.927, 43.12889], [131.928, 43.12889], [131.928, 43.128458], [131.927, 43.128458], [131.926, 43.128458]]]}}, {"type": "Feature", "properties": {"square_id": "172633665992", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.952, 43.148335], [131.952, 43.148767], [131.953, 43.148767], [131.953, 43.148335], [131.952, 43.148335]]]}}, {"type": "Feature", "properties": {"square_id": "172633665694", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.918, 43.148335], [131.918, 43.148767], [131.918, 43.1492], [131.919, 43.1492], [131.919, 43.148767], [131.919, 43.148335], [131.918, 43.148335]]]}}, {"type": "Feature", "properties": {"square_id": "172629471664", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.948, 43.145742], [131.948, 43.146174], [131.949, 43.146174], [131.949, 43.145742], [131.948, 43.145742]]]}}, {"type": "Feature", "properties": {"square_id": "172642054770", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.972, 43.156547], [131.972, 43.156979], [131.973, 43.156979], [131.973, 43.156547], [131.972, 43.156547]]]}}, {"type": "Feature", "properties": {"square_id": "172612694261", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.925, 43.132779], [131.925, 43.133211], [131.926, 43.133211], [131.926, 43.132779], [131.925, 43.132779], [131.927, 43.131915], [131.927, 43.132347], [131.928, 43.132347], [131.928, 43.131915], [131.927, 43.131915]]]}}, {"type": "Feature", "properties": {"square_id": "172612694237", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.927, 43.13105], [131.927, 43.131482], [131.928, 43.131482], [131.928, 43.13105], [131.927, 43.13105]]]}}, {"type": "Feature", "properties": {"square_id": "172616888564", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.926, 43.136235], [131.926, 43.136667], [131.927, 43.136667], [131.927, 43.136235], [131.926, 43.136235], [131.926, 43.135371], [131.926, 43.135803], [131.927, 43.135803], [131.927, 43.135371], [131.926, 43.135371]]]}}, {"type": "Feature", "properties": {"square_id": "172629471763", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.965, 43.144446], [131.965, 43.144878], [131.966, 43.144878], [131.966, 43.144446], [131.965, 43.144446]]]}}, {"type": "Feature", "properties": {"square_id": "172608499956", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.926, 43.128458], [131.926, 43.12889], [131.926, 43.129322], [131.926, 43.129754], [131.927, 43.129754], [131.928, 43.129754], [131.928, 43.129322], [131.927, 43.129322], [131.927, 43.12889], [131.928, 43.12889], [131.928, 43.128458], [131.927, 43.128458], [131.926, 43.128458]]]}}, {"type": "Feature", "properties": {"square_id": "172612694273", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.929, 43.130186], [131.929, 43.130618], [131.93, 43.130618], [131.93, 43.130186], [131.929, 43.130186], [131.925, 43.132779], [131.925, 43.133211], [131.926, 43.133211], [131.926, 43.132779], [131.925, 43.132779], [131.927, 43.133211], [131.927, 43.133643], [131.928, 43.133643], [131.928, 43.133211], [131.927, 43.133211]]]}}, {"type": "Feature", "properties": {"square_id": "172621083031", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.949, 43.137532], [131.949, 43.137964], [131.95, 43.137964], [131.95, 43.137532], [131.949, 43.137532], [131.951, 43.137532], [131.951, 43.137964], [131.952, 43.137964], [131.952, 43.137532], [131.951, 43.137532]]]}}, {"type": "Feature", "properties": {"square_id": "172621083027", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.951, 43.137532], [131.951, 43.137964], [131.952, 43.137964], [131.952, 43.137532], [131.951, 43.137532], [131.949, 43.137532], [131.949, 43.137964], [131.95, 43.137964], [131.95, 43.137532], [131.949, 43.137532]]]}}, {"type": "Feature", "properties": {"square_id": "172616888572", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.926, 43.135371], [131.926, 43.135803], [131.927, 43.135803], [131.927, 43.135371], [131.926, 43.135371], [131.926, 43.136235], [131.926, 43.136667], [131.926, 43.1371], [131.927, 43.1371], [131.928, 43.1371], [131.928, 43.136667], [131.927, 43.136667], [131.927, 43.136235], [131.926, 43.136235]]]}}, {"type": "Feature", "properties": {"square_id": "172616888574", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.926, 43.135371], [131.926, 43.135803], [131.927, 43.135803], [131.927, 43.135371], [131.926, 43.135371], [131.926, 43.136235], [131.926, 43.136667], [131.926, 43.1371], [131.927, 43.1371], [131.928, 43.1371], [131.928, 43.136667], [131.927, 43.136667], [131.927, 43.136235], [131.926, 43.136235]]]}}, {"type": "Feature", "properties": {"square_id": "172608499965", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.928, 43.127162], [131.928, 43.127594], [131.929, 43.127594], [131.929, 43.127162], [131.928, 43.127162], [131.926, 43.128458], [131.926, 43.12889], [131.926, 43.129322], [131.926, 43.129754], [131.927, 43.129754], [131.928, 43.129754], [131.928, 43.129322], [131.927, 43.129322], [131.927, 43.12889], [131.928, 43.12889], [131.928, 43.128458], [131.927, 43.128458], [131.926, 43.128458]]]}}, {"type": "Feature", "properties": {"square_id": "172671414424", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.916, 43.17946], [131.916, 43.179892], [131.917, 43.179892], [131.917, 43.17946], [131.916, 43.17946]]]}}, {"type": "Feature", "properties": {"square_id": "172683997669", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.952, 43.190703], [131.952, 43.191136], [131.953, 43.191136], [131.953, 43.190703], [131.952, 43.190703], [131.955, 43.190703], [131.955, 43.191136], [131.956, 43.191136], [131.956, 43.190703], [131.955, 43.190703]]]}}, {"type": "Feature", "properties": {"square_id": "172683997647", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.955, 43.190703], [131.956, 43.190703], [131.956, 43.190271], [131.955, 43.190271], [131.954, 43.190271], [131.954, 43.190703], [131.955, 43.190703]]]}}, {"type": "Feature", "properties": {"square_id": "172683997664", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.955, 43.190703], [131.955, 43.191136], [131.956, 43.191136], [131.956, 43.190703], [131.955, 43.190703], [131.952, 43.190703], [131.952, 43.191136], [131.953, 43.191136], [131.953, 43.190703], [131.952, 43.190703]]]}}, {"type": "Feature", "properties": {"square_id": "172683997646", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.954, 43.188974], [131.954, 43.189406], [131.955, 43.189406], [131.955, 43.188974], [131.954, 43.188974], [131.954, 43.190271], [131.954, 43.190703], [131.955, 43.190703], [131.956, 43.190703], [131.956, 43.190271], [131.955, 43.190271], [131.954, 43.190271]]]}}, {"type": "Feature", "properties": {"square_id": "172633666850", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[132.056, 43.149632], [132.056, 43.150064], [132.056, 43.150496], [132.057, 43.150496], [132.057, 43.150064], [132.057, 43.149632], [132.056, 43.149632]]]}}, {"type": "Feature", "properties": {"square_id": "172683997636", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.954, 43.188974], [131.954, 43.189406], [131.955, 43.189406], [131.955, 43.188974], [131.954, 43.188974]]]}}, {"type": "Feature", "properties": {"square_id": "172633666856", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[132.056, 43.149632], [132.056, 43.150064], [132.056, 43.150496], [132.057, 43.150496], [132.057, 43.150064], [132.057, 43.149632], [132.056, 43.149632]]]}}, {"type": "Feature", "properties": {"square_id": "172583334626", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.984, 43.107723], [131.984, 43.108155], [131.984, 43.108587], [131.985, 43.108587], [131.985, 43.108155], [131.985, 43.107723], [131.984, 43.107723]]]}}, {"type": "Feature", "properties": {"square_id": "172600111969", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[132.001, 43.121546], [132.001, 43.121978], [132.002, 43.121978], [132.002, 43.121546], [132.001, 43.121546]]]}}, {"type": "Feature", "properties": {"square_id": "172574945950", "sum": 0}, "geometry": {"type": "Polygon", "coordinates": [[[131.982, 43.100382], [131.982, 43.100813], [131.983, 43.100813], [131.983, 43.100382], [131.982, 43.100382]]]}}];

const get_time_key = (value) => {
    value = value === '24' ? 0 : value;
    const prefix = value < 10 ? '0' : '';
    return `${prefix}${value}:00:00`
};

const PeopleFlowMap = () => {

    const [postfix, setPostfix] = useState('час');
    const [rangeValue, setRangeValue] = useState('1');

    const data = {
        type: "FeatureCollection",
        features: get_time_key(rangeValue) in json_data ? json_data[get_time_key(rangeValue)] : [],
    };

    const clusterData = {
        type: "FeatureCollection",
        features: clusterDataFeatures,
    };

    const polygonLayer = {
        key: "2",
        source:{
            data,
        },
        options: {
            autoFit: true,
        },
        size: {
            values: 1,
        },
        color: {
            field: "sum",
            values: (d) => {
                return d > 60 ?
                    "rgba(0, 81, 207, 2.30)"
                    : d > 50 ?
                        "rgba(0, 81, 207, 1.95)"
                        : d > 40 ?
                            "rgba(0, 81, 207, 1.85)"
                            : d > 30 ?
                                "rgba(0, 81, 207, 1.4)"
                                : d > 15 ?
                                    "rgba(0, 81, 207, 1.2)"
                                    : "rgba(0, 81, 207, 1.0)";
            },
        },
        shape: {
            values: "fill",
        },
        select: {
            option: { color: "#000" },
        },
        style: {
            opacity: 0.3,
        },
        active: {
            option: {
                color: "#696969",
            },
        }
    };

    const clusterLayer = {
        key: "5",
        source:{
            data: clusterData,
        },
        options: {
            autoFit: true,
        },
        size: {
            values: 1,
        },
        color: {
            field: "sum",
            values: (d) => {
                return "#A32B2B"
            },
        },
        shape: {
            values: "fill",
        },
        select: {
            option: { color: "#000" },
        },
        style: {
            opacity: 0.3,
        },
        active: {
            option: {
                color: "#696969",
            },
        }
    };

    const amtLayer = {
        key: "4",
        options: {
            autoFit: true,
        },
        source: {
            data: atmData,
            parser: {
                type: "json",
                x: "longitude",
                y: "latitude",
            },
        },
        shape: {
            values: ["газпромбанк"],
        },
        size: {
            values: 10,
        },
        style: {
            opacity: 1,
        },
    };

    return (
        <div className="content">
            <MapboxScene
                map={{
                    center: [131.936867, 43.126133],
                    pitch: 4.0,
                    zoom: 10.55,
                    rotation: 0.313180925794313,
                    style: "normal",
                }}
                style={{
                    minHeight: "800px",
                    justifyContent: "center",
                    position: "relative",
                }}
            >
                <LoadImage
                    name="газпромбанк"
                    url={gpb}
                />
                {atmData && <PointLayer {...amtLayer}></PointLayer>}
                {data && [
                    <PolygonLayer
                        {...polygonLayer}
                    />,
                ]}
                {clusterData && [
                    <PolygonLayer
                        {...clusterLayer}
                    />,
                ]}
            </MapboxScene>

            <InputRange
                value={rangeValue}
                onChange={(e, value) => {
                    if (value && value > '4') {
                        setPostfix('часов');
                    }
                    if (value && value > '1' && value <= '4') {
                        setPostfix('часа');
                    }
                    if (value && value === '1') {
                        setPostfix('час');
                    }

                    setRangeValue(value);
                }}
                minValue={1}
                maxValue={24}
                ranges={[...Array(22)].map((e, i) => {return {value: i + 2}})}
                isOnlyRangesValues={true}
                postfix={postfix}
                placeholder="Выберите время"
                isMobile={true}
            />
        </div>
    );
};

export default PeopleFlowMap;
